📘 Business Rules (MVP)

docs/01_business_rules.md

1. 목적 (Purpose)

본 문서는 **MasterPlan 프로젝트 관리 시스템(MVP)**의
업무 분류 체계, 데이터 구조, 기본 운영 규칙을 정의한다.

본 시스템은 제조 프로젝트를 기준으로
**대/중/소 분류를 고정 구조가 아닌 “확장 가능한 트리 구조”**로 관리하는 것을 핵심 목표로 한다.

2. 핵심 개념 정의 (Core Concepts)
2.1 프로젝트 (Project)

하나의 실제 제조/개발 단위를 의미한다.

예: HB-130X(#1035)

모든 분류(Classification)와 작업(Task)은 반드시 하나의 프로젝트에 속한다.

2.2 분류 (Classification)

업무를 논리적으로 구분하는 트리(Tree) 구조의 노드

기존의 “대분류 / 중분류 / 소분류” 개념을 일반화한 구조

깊이(depth)는 고정되지 않으며, MVP에서는 관례적으로 3단계 사용

분류의 속성
항목	설명
project_id	소속 프로젝트
parent_id	상위 분류 (NULL이면 루트)
name	분류명
depth	트리 깊이 (0부터 시작)
path	전체 경로 (/X축/TABLE BED/설계)
sort_no	정렬 순서
2.3 분류 Depth 규칙 (MVP 관례)

기술적 제한은 없으나, MVP에서는 아래 관례를 따른다

depth	의미
0	대분류 (예: X축, B축)
1	중분류 (예: TABLE BED, 구매품)
2	소분류 (예: 설계, 가공, 입고 등)
2.4 경로(Path) 규칙

path는 프로젝트 내에서 유일(unique) 하다.

/로 시작하며, 부모 → 자식 순으로 누적된다.

예:

/X축
/X축/TABLE BED
/X축/TABLE BED/설계

경로의 역할

트리 구조를 빠르게 조회

전체 분류의 유일성 보장

재귀 CTE 없이도 부분 조회 가능

3. 분류 생성 규칙
3.1 이름 중복 허용 규칙

서로 다른 부모 아래에서는 같은 name 허용

같은 부모 아래에서는 name 중복 불가

예:

허용

/X축/구매품/Bearing 입고
/B축/구매품/Bearing 입고


불가

/X축/구매품/Bearing 입고
/X축/구매품/Bearing 입고 (중복)

3.2 분류의 생성/수정 원칙

분류는 **삭제보다는 비활성화(is_active=false)**를 우선 고려한다.

path 변경은 하위 모든 분류에 영향을 주므로 신중히 처리한다.

MVP 단계에서는 path 변경을 제한한다.

4. 작업(Task) 규칙
4.1 작업의 정의

실제 수행되는 업무 단위

하나의 작업은 반드시 하나의 분류(Classification) 에 속한다.

4.2 작업 연결 원칙

일반적으로 소분류(depth=2) 에 작업을 연결한다.

필요 시 중분류/대분류 연결도 기술적으로는 가능하다.

5. 데이터 무결성 원칙
5.1 삭제 정책
대상	정책
Project	삭제 시 하위 분류/작업 모두 삭제
Classification	상위 삭제 시 하위 cascade
Classification ↔ Task	분류 삭제 시 작업 삭제 방지 (RESTRICT)
5.2 권한 원칙

애플리케이션은 DB 롤 hnkerp 로만 접근한다.

DDL/마이그레이션은 관리자(postgres)만 수행한다.

6. MVP 범위 (Out of Scope)

아래 항목은 MVP 범위에서 제외한다.

분류 depth 무제한 UI 편집

분류 path 자동 리팩토링

다중 프로젝트 간 분류 복사

작업 공정 간 의존성 관리

일정/공정 캘린더

7. 설계 방향 요약

❌ 고정된 대/중/소 테이블 구조 사용하지 않음

✅ 단일 분류 테이블 + 재귀 구조

✅ path 기반 조회 + 확장성 확보

✅ 제조 프로젝트별 독립된 트리 관리

8. 변경 이력
날짜	내용
2025-12-22	재귀 분류 구조 기반으로 전면 개편